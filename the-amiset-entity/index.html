<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" class="h-full" data-vue-tag="lang,class">
  <head>
    <title data-vue-tag="true">The AmiSet Entity  | Ana Rute</title><meta data-vue-tag="true" charset="utf-8"><meta data-vue-tag="true" name="generator" content="Gridsome v0.6.7"><meta data-vue-tag="true" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="true" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="true" data-key="description" name="description" content="Taskcluster is a complex and big project and I&#x27;m working on a specific part of it: where we manage the Amazon instances and Machine Images (AMIs). As I&#x27;ve mentioned in my last post, my job here starts by creating a new database entity called AMI set, which stores sets of AMIs key ..."><meta data-vue-tag="true" property="og:type" content="article"><meta data-vue-tag="true" property="og:title" content="The AmiSet Entity"><meta data-vue-tag="true" property="og:description" content="Taskcluster is a complex and big project and I&#x27;m working on a specific part of it: where we manage the Amazon instances and Machine Images (AMIs). As I&#x27;ve mentioned in my last post, my job here starts by creating a new database entity called AMI set, which stores sets of AMIs key ..."><meta data-vue-tag="true" property="og:url" content="https://anarute.com/the-amiset-entity/"><meta data-vue-tag="true" property="article:published_time" content="2020-05-26"><meta data-vue-tag="true" property="og:image" content="https://anarute.com/images/card.png"><meta data-vue-tag="true" name="twitter:card" content="summary_large_image"><meta data-vue-tag="true" name="twitter:title" content="The AmiSet Entity"><meta data-vue-tag="true" name="twitter:description" content="Taskcluster is a complex and big project and I&#x27;m working on a specific part of it: where we manage the Amazon instances and Machine Images (AMIs). As I&#x27;ve mentioned in my last post, my job here starts by creating a new database entity called AMI set, which stores sets of AMIs key ..."><meta data-vue-tag="true" name="twitter:site" content="@ana_rute"><meta data-vue-tag="true" name="twitter:creator" content="@ana_rute"><meta data-vue-tag="true" name="twitter:image" content="https://anarute.com/images/card.png"><link data-vue-tag="true" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.efcb514.png"><link data-vue-tag="true" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.efcb514.png"><link data-vue-tag="true" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.efcb514.png"><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.efcb514.png"><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.efcb514.png"><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.efcb514.png"><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.efcb514.png"><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.efcb514.png"><link data-vue-tag="true" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:400,700%7CCardo"><noscript data-vue-tag="true" ><style>.g-image--loading{display:none;}</style></noscript><link rel="preload" href="/assets/css/9.styles.387d894c.css" as="style"><link rel="preload" href="/assets/js/app.8d10cb4f.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.2e93ef91.js" as="script"><link rel="prefetch" href="/assets/js/11.33e49a77.js"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.9f2b73be.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.fe704e0d.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.8ef1ebfb.js"><link rel="prefetch" href="/assets/js/page--src--pages--tailwind-vue.c76f3ebf.js"><link rel="prefetch" href="/assets/js/page--src--templates--author-vue.419f47de.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.a71cdd5c.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--index-vue~page--src--templates--author-vue~page--src--templates--post-vue~~a0fae544.1140ed21.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--post-vue.797d1a20.js"><link rel="stylesheet" href="/assets/css/9.styles.387d894c.css">
  </head>
  <body class="antialiased font-serif" data-vue-tag="class">
    <div data-server-rendered="true" id="app"><main><header><div class="pt-24"><div class="max-w-xl md:max-w-3xl xl:max-w-4xl mx-auto text-center px-6"><p class="text-gray-700 text-xs mb-2 uppercase">2 min read</p><h1 class="text-3xl sm:text-5xl leading-tight font-sans font-bold mb-2 text-black">The AmiSet Entity</h1><p class="text-gray-700"><span><a href="/author/anarute/" class="text-gray-700 capitalize border-b border-transparent hover:border-gray-400 transition-border-color">Anarute</a> •
        </span><time datetime="2016-06-10 14:30:43" class="capitalize">10 June, 2016</time></p></div></div><nav class="absolute top-0 left-0 z-20 mt-6 ml-6"><a href="/" class="text-sm border opacity-75 hover:opacity-100 rounded-full px-4 py-2 transition-opacity active text-gray-900 border-gray-400">← Home</a></nav></header><article class="max-w-xl md:max-w-2xl xl:max-w-3xl mx-auto px-6 sm:px-12 pt-16"><div role="alert" class="leading-normal p-4 md:mx-6 mb-12 bg-orange-100 border-l-4 border-orange-500 text-orange-900">
        This post is over a year old, some of this information may be out of date.
      </div><div class="markdown text-lg leading-normal text-gray-700 pb-10"><p>Taskcluster is a complex and big project and I'm working on a specific part of it: where we manage the Amazon instances and Machine Images (AMIs). As I've mentioned in my <a href="http://anarute.com/getting-started-with-taskcluster/" target="_blank" rel="nofollow noopener noreferrer">last post</a>, my job here starts by creating a new database entity called AMI set, which stores sets of AMIs keyed by region and virtualization type.</p>
<p>My work during the last two weeks were to understand how the AWS provisioner project is organized and how to create a new entity. Since I was creating something I knew nothing about, start coding seems to be the hardest part because I have no references of things I've done before and I need to learn basically everything. A good advice for newbies would be to chop everything into the smallest parts we can (I think this fits for almost every job and area).</p>
<p>I took the Worker Type entity as my starting point as suggested by <a href="http://code.v.igoro.us/" target="_blank" rel="nofollow noopener noreferrer">Dustin</a> - my mentor - and wrote the AMI Set entity definition by checking what I could replicate from WorkerType and discarding what didn't make sense. Which ended up with this basic definition:</p>
<pre>let AmiSet = base.Entity.configure({

properties: {
    id: base.Entity.types.String,
    amis: base.Entity.types.JSON,
    // Store the date of last modification for this entity
    lastModified: base.Entity.types.Date,
  },
});
</pre>
<p>This is a very simple entity and its core part is the <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">amis</code> property, which needs to store the AMIs by region and virtualization type. The thing is, since it is a "generic" JSON object we need to decide how the object will be. We have mainly two options:</p>
<pre>{
   "us-west-1": {
      "hvm": "ami-111",
      "pv": "ami-222"
  },
   "us-east-1": {
      "hvm": "ami-111",
      "pv": "ami-222"
  }
}
</pre>
<p>Or</p>
<pre>[
   {
      "region": "us-west-1",
      "hvm": "ami-111",
      "pv": "ami-222"
   },
   {
      "region": "us-east-1",
      "hvm": "ami-111",
      "pv": "ami-222"
   }
]
</pre>
<p>As <a href="https://github.com/taskcluster/aws-provisioner/pull/85#discussion-diff-66091884" target="_blank" rel="nofollow noopener noreferrer">@jhford pointed and @djmitche agrees</a>:</p>
<blockquote>
<p>Whether we have a list of objects or a straight mapping is something that you'll have to pick. A list of objects is really nice because you can do really neat things with <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">Array.prototype.map</code> and <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">Array.prototype.filter</code>. A mapping is really nice because it's easier to address the values and it is impossible to have duplicates. Error checking with the object will be easier, but the list of objects is more in line with what we do elsewhere in the provisioner and probably what I'd prefer to see.</p>
</blockquote>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/prototype" target="_blank" rel="nofollow noopener noreferrer">Here</a> we can see more methods that we can do with <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">Array.prototype</code>. As explained above, probably we'll go with the list of objects option.</p>
<p>After creating the entity I started adding its create and delete endpoints. The hardest part this time was to understand the functions and specially if I was dealing with instances, classes or properties.</p>
<p>The thing that made me learn the most were <a href="https://github.com/taskcluster/aws-provisioner/pull/85" target="_blank" rel="nofollow noopener noreferrer">the comments</a> Dustin and John made in my Pull Request. It is really helpful to know the things you are doing right or wrong and to know where to go from there. So an important advice here is to start sending patches as soon as possible and don't fear making mistakes - they will happen anyway and we can only learn from them.</p>
</div><footer class="flex flex-wrap pb-10 sm:pb-16"><div><a href="/tag/outreachy/" class="inline-block text-teal-400 hover:text-white hover:bg-teal-400 border border-teal-400 font-sans font-bold text-xs sm:text-sm px-4 py-2 mr-4 mb-2 rounded-full transition-color transition-bg"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" role="img" class="inline w-3 fill-current align-middle mr-1"><path d="M0 10V2l2-2h8l10 10-10 10L0 10zm4.5-4a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"></path></svg>
          outreachy
          </a><a href="/tag/FOSS/" class="inline-block text-teal-400 hover:text-white hover:bg-teal-400 border border-teal-400 font-sans font-bold text-xs sm:text-sm px-4 py-2 mr-4 mb-2 rounded-full transition-color transition-bg"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" role="img" class="inline w-3 fill-current align-middle mr-1"><path d="M0 10V2l2-2h8l10 10-10 10L0 10zm4.5-4a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"></path></svg>
          FOSS
          </a><a href="/tag/taskcluster/" class="inline-block text-teal-400 hover:text-white hover:bg-teal-400 border border-teal-400 font-sans font-bold text-xs sm:text-sm px-4 py-2 mr-4 mb-2 rounded-full transition-color transition-bg"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" role="img" class="inline w-3 fill-current align-middle mr-1"><path d="M0 10V2l2-2h8l10 10-10 10L0 10zm4.5-4a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"></path></svg>
          taskcluster
          </a><a href="/tag/Mozilla/" class="inline-block text-teal-400 hover:text-white hover:bg-teal-400 border border-teal-400 font-sans font-bold text-xs sm:text-sm px-4 py-2 mr-4 mb-2 rounded-full transition-color transition-bg"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" role="img" class="inline w-3 fill-current align-middle mr-1"><path d="M0 10V2l2-2h8l10 10-10 10L0 10zm4.5-4a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"></path></svg>
          Mozilla
          </a></div><div class="flex flex-wrap items-center justify-center sm:justify-left border-t border-b border-gray-300 w-full mt-10 py-10 sm:px-16"><figure class="px-2 mb-1 sm:mb-0 w-full sm:w-1/5 flex justify-center"><a href="/author/anarute/"><img src="/images/authors/anarute.png" alt="anarute" width="100" class="rounded-full p-4 sm:p-0"></a></figure><div class="px-4 sm:w-4/5 text-center sm:text-left"><h4 class="font-sans font-bold text-lg sm:text-xl mb-2 sm:mb-4"><a href="/author/anarute/" class="text-black hover:text-gray-600 capitalize border-b-2 border-transparent transition-color">Anarute</a></h4><p class="leading-normal"><a href="/author/anarute/" class="text-blue-500 hover:text-blue-400 transition-color">See all posts by Anarute →</a></p></div></div></footer><div id="disqus_thread"></div></article><footer class="text-gray-700 text-sm leading-normal flex flex-wrap justify-between mx-auto max-w-3xl px-6 sm:px-12 pb-8 sm:pb-10"><div class="w-full sm:w-1/2 mb-4 sm:mb-0"><p>Based on <a href="https://github.com/cossssmin/gridsome-starter-bleda" class="border-b border-transparent hover:border-gray-400 transition-border-color">Bleda</a> by <a href="https://twitter.com/cossssmin" class="border-b border-transparent hover:border-gray-400 transition-border-color">@cossssmin</a></p></div><div class="w-full sm:w-1/2"><nav><ul class="flex sm:justify-end -mx-2"><li class="px-2"><a href="/" class="border-b border-transparent hover:border-gray-400 transition-border-color active">Home</a></li><li class="px-2"><a href="/about/" class="border-b border-transparent hover:border-gray-400 transition-border-color">About</a></li><li class="px-2"><a href="/sitemap.xml" class="border-b border-transparent hover:border-gray-400 transition-border-color">Sitemap</a></li><li class="px-2"><a href="/feed.xml" class="border-b border-transparent hover:border-gray-400 transition-border-color">RSS Feed</a></li></ul></nav></div></footer></main></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"title":"The AmiSet Entity","slug":"the-amiset-entity","datetime":"2016-06-10 14:30:43","content":"\u003Cp\u003ETaskcluster is a complex and big project and I'm working on a specific part of it: where we manage the Amazon instances and Machine Images (AMIs). As I've mentioned in my \u003Ca href=\"http:\u002F\u002Fanarute.com\u002Fgetting-started-with-taskcluster\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Elast post\u003C\u002Fa\u003E, my job here starts by creating a new database entity called AMI set, which stores sets of AMIs keyed by region and virtualization type.\u003C\u002Fp\u003E\n\u003Cp\u003EMy work during the last two weeks were to understand how the AWS provisioner project is organized and how to create a new entity. Since I was creating something I knew nothing about, start coding seems to be the hardest part because I have no references of things I've done before and I need to learn basically everything. A good advice for newbies would be to chop everything into the smallest parts we can (I think this fits for almost every job and area).\u003C\u002Fp\u003E\n\u003Cp\u003EI took the Worker Type entity as my starting point as suggested by \u003Ca href=\"http:\u002F\u002Fcode.v.igoro.us\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EDustin\u003C\u002Fa\u003E - my mentor - and wrote the AMI Set entity definition by checking what I could replicate from WorkerType and discarding what didn't make sense. Which ended up with this basic definition:\u003C\u002Fp\u003E\n\u003Cpre\u003Elet AmiSet = base.Entity.configure({\n\nproperties: {\n    id: base.Entity.types.String,\n    amis: base.Entity.types.JSON,\n    \u002F\u002F Store the date of last modification for this entity\n    lastModified: base.Entity.types.Date,\n  },\n});\n\u003C\u002Fpre\u003E\n\u003Cp\u003EThis is a very simple entity and its core part is the \u003Ccode class=\"shiki-inline\" style=\"background: #2e3440; color: #d8dee9\"\u003Eamis\u003C\u002Fcode\u003E property, which needs to store the AMIs by region and virtualization type. The thing is, since it is a \"generic\" JSON object we need to decide how the object will be. We have mainly two options:\u003C\u002Fp\u003E\n\u003Cpre\u003E{\n   \"us-west-1\": {\n      \"hvm\": \"ami-111\",\n      \"pv\": \"ami-222\"\n  },\n   \"us-east-1\": {\n      \"hvm\": \"ami-111\",\n      \"pv\": \"ami-222\"\n  }\n}\n\u003C\u002Fpre\u003E\n\u003Cp\u003EOr\u003C\u002Fp\u003E\n\u003Cpre\u003E[\n   {\n      \"region\": \"us-west-1\",\n      \"hvm\": \"ami-111\",\n      \"pv\": \"ami-222\"\n   },\n   {\n      \"region\": \"us-east-1\",\n      \"hvm\": \"ami-111\",\n      \"pv\": \"ami-222\"\n   }\n]\n\u003C\u002Fpre\u003E\n\u003Cp\u003EAs \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Ftaskcluster\u002Faws-provisioner\u002Fpull\u002F85#discussion-diff-66091884\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003E@jhford pointed and @djmitche agrees\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003EWhether we have a list of objects or a straight mapping is something that you'll have to pick. A list of objects is really nice because you can do really neat things with \u003Ccode class=\"shiki-inline\" style=\"background: #2e3440; color: #d8dee9\"\u003EArray.prototype.map\u003C\u002Fcode\u003E and \u003Ccode class=\"shiki-inline\" style=\"background: #2e3440; color: #d8dee9\"\u003EArray.prototype.filter\u003C\u002Fcode\u003E. A mapping is really nice because it's easier to address the values and it is impossible to have duplicates. Error checking with the object will be easier, but the list of objects is more in line with what we do elsewhere in the provisioner and probably what I'd prefer to see.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FGlobal_Objects\u002FArray\u002Fprototype\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EHere\u003C\u002Fa\u003E we can see more methods that we can do with \u003Ccode class=\"shiki-inline\" style=\"background: #2e3440; color: #d8dee9\"\u003EArray.prototype\u003C\u002Fcode\u003E. As explained above, probably we'll go with the list of objects option.\u003C\u002Fp\u003E\n\u003Cp\u003EAfter creating the entity I started adding its create and delete endpoints. The hardest part this time was to understand the functions and specially if I was dealing with instances, classes or properties.\u003C\u002Fp\u003E\n\u003Cp\u003EThe thing that made me learn the most were \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Ftaskcluster\u002Faws-provisioner\u002Fpull\u002F85\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ethe comments\u003C\u002Fa\u003E Dustin and John made in my Pull Request. It is really helpful to know the things you are doing right or wrong and to know where to go from there. So an important advice here is to start sending patches as soon as possible and don't fear making mistakes - they will happen anyway and we can only learn from them.\u003C\u002Fp\u003E\n","description":"","timeToRead":2,"cover":"","fullscreen":false,"author":{"id":"anarute","title":"anarute","path":"\u002Fauthor\u002Fanarute"},"tags":[{"id":"outreachy","title":"outreachy","path":"\u002Ftag\u002Foutreachy"},{"id":"FOSS","title":"FOSS","path":"\u002Ftag\u002FFOSS"},{"id":"taskcluster","title":"taskcluster","path":"\u002Ftag\u002Ftaskcluster"},{"id":"Mozilla","title":"Mozilla","path":"\u002Ftag\u002FMozilla"}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.8d10cb4f.js" defer></script><script src="/assets/js/page--src--templates--post-vue.2e93ef91.js" defer></script>
  </body>
</html>
