<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" class="h-full" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D,%22class%22:%7B%22ssr%22:%22h-full%22%7D%7D">
  <head>
    <title>The AmiSet Entity  | Ana Rute</title><meta name="gridsome:hash" content="4f7e495cf579bdf3a8f4c48806d06b43e7b94c7b"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="Taskcluster is a complex and big project and I&#x27;m working on a specific part of it: where we manage the Amazon instances and Machine Images (AMIs). As I&#x27;ve mentioned in my last post, my job here starts by creating a new database entity called AMI set, which stores sets of AMIs key ..."><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content="The AmiSet Entity"><meta data-vue-tag="ssr" property="og:description" content="Taskcluster is a complex and big project and I&#x27;m working on a specific part of it: where we manage the Amazon instances and Machine Images (AMIs). As I&#x27;ve mentioned in my last post, my job here starts by creating a new database entity called AMI set, which stores sets of AMIs key ..."><meta data-vue-tag="ssr" property="og:url" content="https://anarute.com/the-amiset-entity/"><meta data-vue-tag="ssr" property="article:published_time" content="2021-08-29"><meta data-vue-tag="ssr" property="og:image" content="https://anarute.com/images/card.png"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:title" content="The AmiSet Entity"><meta data-vue-tag="ssr" name="twitter:description" content="Taskcluster is a complex and big project and I&#x27;m working on a specific part of it: where we manage the Amazon instances and Machine Images (AMIs). As I&#x27;ve mentioned in my last post, my job here starts by creating a new database entity called AMI set, which stores sets of AMIs key ..."><meta data-vue-tag="ssr" name="twitter:site" content="@ana_rute"><meta data-vue-tag="ssr" name="twitter:creator" content="@ana_rute"><meta data-vue-tag="ssr" name="twitter:image" content="https://anarute.com/images/card.png"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.1dbd3df5a133ad4bfceee6f845dec19f.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.1dbd3df5a133ad4bfceee6f845dec19f.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.1dbd3df5a133ad4bfceee6f845dec19f.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.1dbd3df5a133ad4bfceee6f845dec19f.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:400,700%7CCardo"><link rel="preload" href="/assets/css/10.styles.71c6ed44.css" as="style"><link rel="preload" href="/assets/js/app.b9c80bf7.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.c0a25600.js" as="script"><link rel="prefetch" href="/assets/js/12.bf723347.js"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.2347d897.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.99b74215.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.5f126c02.js"><link rel="prefetch" href="/assets/js/page--src--pages--talks-vue.5513b98e.js"><link rel="prefetch" href="/assets/js/page--src--pages--uses-vue.c5f56cc6.js"><link rel="prefetch" href="/assets/js/page--src--templates--author-vue.f0357935.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.7b7d9ef0.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--index-vue~page--src--templates--author-vue~page--src--templates--post-vue~~a0fae544.81352eac.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--post-vue.53a53220.js"><link rel="stylesheet" href="/assets/css/10.styles.71c6ed44.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body class="antialiased font-serif" data-vue-tag="%7B%22class%22:%7B%22ssr%22:%22antialiased%20font-serif%22%7D%7D">
    <div data-server-rendered="true" id="app" class="layout"><section class="menu"><div><nav><ul><li><a href="/" class="active">posts</a></li><li><a href="/about/">about</a></li><li><a href="/uses/">setup</a></li><li><a href="/talks/">talks</a></li><li><a href="/feed.xml">RSS Feed</a></li></ul></nav></div></section><main><header><div><div><h1>The AmiSet Entity</h1><p><span><a href="/author/anarute/">anarute</a>
          â€¢
        </span><time datetime="2016-06-10 14:30:43">10 June, 2016</time></p></div></div></header><article><div role="alert" class="warning">
        This post is over a year old, some of this information may be out of
        date.
      </div><div><p>Taskcluster is a complex and big project and I'm working on a specific part of it: where we manage the Amazon instances and Machine Images (AMIs). As I've mentioned in my <a href="http://anarute.com/getting-started-with-taskcluster/" target="_blank" rel="nofollow noopener noreferrer">last post</a>, my job here starts by creating a new database entity called AMI set, which stores sets of AMIs keyed by region and virtualization type.</p>
<p>My work during the last two weeks were to understand how the AWS provisioner project is organized and how to create a new entity. Since I was creating something I knew nothing about, start coding seems to be the hardest part because I have no references of things I've done before and I need to learn basically everything. A good advice for newbies would be to chop everything into the smallest parts we can (I think this fits for almost every job and area).</p>
<p>I took the Worker Type entity as my starting point as suggested by <a href="http://code.v.igoro.us/" target="_blank" rel="nofollow noopener noreferrer">Dustin</a> - my mentor - and wrote the AMI Set entity definition by checking what I could replicate from WorkerType and discarding what didn't make sense. Which ended up with this basic definition:</p>
<pre>let AmiSet = base.Entity.configure({

properties: {
    id: base.Entity.types.String,
    amis: base.Entity.types.JSON,
    // Store the date of last modification for this entity
    lastModified: base.Entity.types.Date,
  },
});
</pre>
<p>This is a very simple entity and its core part is the <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">amis</code> property, which needs to store the AMIs by region and virtualization type. The thing is, since it is a "generic" JSON object we need to decide how the object will be. We have mainly two options:</p>
<pre>{
   "us-west-1": {
      "hvm": "ami-111",
      "pv": "ami-222"
  },
   "us-east-1": {
      "hvm": "ami-111",
      "pv": "ami-222"
  }
}
</pre>
<p>Or</p>
<pre>[
   {
      "region": "us-west-1",
      "hvm": "ami-111",
      "pv": "ami-222"
   },
   {
      "region": "us-east-1",
      "hvm": "ami-111",
      "pv": "ami-222"
   }
]
</pre>
<p>As <a href="https://github.com/taskcluster/aws-provisioner/pull/85#discussion-diff-66091884" target="_blank" rel="nofollow noopener noreferrer">@jhford pointed and @djmitche agrees</a>:</p>
<blockquote>
<p>Whether we have a list of objects or a straight mapping is something that you'll have to pick. A list of objects is really nice because you can do really neat things with <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">Array.prototype.map</code> and <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">Array.prototype.filter</code>. A mapping is really nice because it's easier to address the values and it is impossible to have duplicates. Error checking with the object will be easier, but the list of objects is more in line with what we do elsewhere in the provisioner and probably what I'd prefer to see.</p>
</blockquote>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/prototype" target="_blank" rel="nofollow noopener noreferrer">Here</a> we can see more methods that we can do with <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">Array.prototype</code>. As explained above, probably we'll go with the list of objects option.</p>
<p>After creating the entity I started adding its create and delete endpoints. The hardest part this time was to understand the functions and specially if I was dealing with instances, classes or properties.</p>
<p>The thing that made me learn the most were <a href="https://github.com/taskcluster/aws-provisioner/pull/85" target="_blank" rel="nofollow noopener noreferrer">the comments</a> Dustin and John made in my Pull Request. It is really helpful to know the things you are doing right or wrong and to know where to go from there. So an important advice here is to start sending patches as soon as possible and don't fear making mistakes - they will happen anyway and we can only learn from them.</p>
</div><footer><div><a href="/tag/outreachy/" class="tag">
            outreachy
          </a><a href="/tag/FOSS/" class="tag">
            FOSS
          </a><a href="/tag/taskcluster/" class="tag">
            taskcluster
          </a><a href="/tag/Mozilla/" class="tag">
            Mozilla
          </a></div></footer><div id="disqus_thread"></div></article></main></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"title":"The AmiSet Entity","slug":"the-amiset-entity","datetime":"2016-06-10 14:30:43","content":"\u003Cp\u003ETaskcluster is a complex and big project and I'm working on a specific part of it: where we manage the Amazon instances and Machine Images (AMIs). As I've mentioned in my \u003Ca href=\"http:\u002F\u002Fanarute.com\u002Fgetting-started-with-taskcluster\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Elast post\u003C\u002Fa\u003E, my job here starts by creating a new database entity called AMI set, which stores sets of AMIs keyed by region and virtualization type.\u003C\u002Fp\u003E\n\u003Cp\u003EMy work during the last two weeks were to understand how the AWS provisioner project is organized and how to create a new entity. Since I was creating something I knew nothing about, start coding seems to be the hardest part because I have no references of things I've done before and I need to learn basically everything. A good advice for newbies would be to chop everything into the smallest parts we can (I think this fits for almost every job and area).\u003C\u002Fp\u003E\n\u003Cp\u003EI took the Worker Type entity as my starting point as suggested by \u003Ca href=\"http:\u002F\u002Fcode.v.igoro.us\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EDustin\u003C\u002Fa\u003E - my mentor - and wrote the AMI Set entity definition by checking what I could replicate from WorkerType and discarding what didn't make sense. Which ended up with this basic definition:\u003C\u002Fp\u003E\n\u003Cpre\u003Elet AmiSet = base.Entity.configure({\n\nproperties: {\n    id: base.Entity.types.String,\n    amis: base.Entity.types.JSON,\n    \u002F\u002F Store the date of last modification for this entity\n    lastModified: base.Entity.types.Date,\n  },\n});\n\u003C\u002Fpre\u003E\n\u003Cp\u003EThis is a very simple entity and its core part is the \u003Ccode class=\"shiki-inline\" style=\"background: #2e3440; color: #d8dee9\"\u003Eamis\u003C\u002Fcode\u003E property, which needs to store the AMIs by region and virtualization type. The thing is, since it is a \"generic\" JSON object we need to decide how the object will be. We have mainly two options:\u003C\u002Fp\u003E\n\u003Cpre\u003E{\n   \"us-west-1\": {\n      \"hvm\": \"ami-111\",\n      \"pv\": \"ami-222\"\n  },\n   \"us-east-1\": {\n      \"hvm\": \"ami-111\",\n      \"pv\": \"ami-222\"\n  }\n}\n\u003C\u002Fpre\u003E\n\u003Cp\u003EOr\u003C\u002Fp\u003E\n\u003Cpre\u003E[\n   {\n      \"region\": \"us-west-1\",\n      \"hvm\": \"ami-111\",\n      \"pv\": \"ami-222\"\n   },\n   {\n      \"region\": \"us-east-1\",\n      \"hvm\": \"ami-111\",\n      \"pv\": \"ami-222\"\n   }\n]\n\u003C\u002Fpre\u003E\n\u003Cp\u003EAs \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Ftaskcluster\u002Faws-provisioner\u002Fpull\u002F85#discussion-diff-66091884\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003E@jhford pointed and @djmitche agrees\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003EWhether we have a list of objects or a straight mapping is something that you'll have to pick. A list of objects is really nice because you can do really neat things with \u003Ccode class=\"shiki-inline\" style=\"background: #2e3440; color: #d8dee9\"\u003EArray.prototype.map\u003C\u002Fcode\u003E and \u003Ccode class=\"shiki-inline\" style=\"background: #2e3440; color: #d8dee9\"\u003EArray.prototype.filter\u003C\u002Fcode\u003E. A mapping is really nice because it's easier to address the values and it is impossible to have duplicates. Error checking with the object will be easier, but the list of objects is more in line with what we do elsewhere in the provisioner and probably what I'd prefer to see.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FGlobal_Objects\u002FArray\u002Fprototype\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EHere\u003C\u002Fa\u003E we can see more methods that we can do with \u003Ccode class=\"shiki-inline\" style=\"background: #2e3440; color: #d8dee9\"\u003EArray.prototype\u003C\u002Fcode\u003E. As explained above, probably we'll go with the list of objects option.\u003C\u002Fp\u003E\n\u003Cp\u003EAfter creating the entity I started adding its create and delete endpoints. The hardest part this time was to understand the functions and specially if I was dealing with instances, classes or properties.\u003C\u002Fp\u003E\n\u003Cp\u003EThe thing that made me learn the most were \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Ftaskcluster\u002Faws-provisioner\u002Fpull\u002F85\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ethe comments\u003C\u002Fa\u003E Dustin and John made in my Pull Request. It is really helpful to know the things you are doing right or wrong and to know where to go from there. So an important advice here is to start sending patches as soon as possible and don't fear making mistakes - they will happen anyway and we can only learn from them.\u003C\u002Fp\u003E\n","description":"","cover":"","fullscreen":false,"author":{"id":"anarute","title":"anarute","path":"\u002Fauthor\u002Fanarute\u002F"},"tags":[{"id":"outreachy","title":"outreachy","path":"\u002Ftag\u002Foutreachy\u002F"},{"id":"FOSS","title":"FOSS","path":"\u002Ftag\u002FFOSS\u002F"},{"id":"taskcluster","title":"taskcluster","path":"\u002Ftag\u002Ftaskcluster\u002F"},{"id":"Mozilla","title":"Mozilla","path":"\u002Ftag\u002FMozilla\u002F"}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.b9c80bf7.js" defer></script><script src="/assets/js/page--src--templates--post-vue.c0a25600.js" defer></script>
  </body>
</html>
