<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" class="h-full" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D,%22class%22:%7B%22ssr%22:%22h-full%22%7D%7D">
  <head>
    <title>Como restaurar backups em um banco PostgreSQL  | Ana Rute</title><meta name="gridsome:hash" content="4f7e495cf579bdf3a8f4c48806d06b43e7b94c7b"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="Guia básico para criar e restaurar um dump de um banco em PostgreSQL"><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content="Como restaurar backups em um banco PostgreSQL"><meta data-vue-tag="ssr" property="og:description" content="Guia básico para criar e restaurar um dump de um banco em PostgreSQL"><meta data-vue-tag="ssr" property="og:url" content="https://anarute.com/como-restaurar-backups-em-um-banco-postgresql/"><meta data-vue-tag="ssr" property="article:published_time" content="2021-08-29"><meta data-vue-tag="ssr" property="og:image" content="https://images.unsplash.com/photo-1495669735947-8ebe33b049bf?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1920&amp;h=1080&amp;q=80"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:title" content="Como restaurar backups em um banco PostgreSQL"><meta data-vue-tag="ssr" name="twitter:description" content="Guia básico para criar e restaurar um dump de um banco em PostgreSQL"><meta data-vue-tag="ssr" name="twitter:site" content="@ana_rute"><meta data-vue-tag="ssr" name="twitter:creator" content="@ana_rute"><meta data-vue-tag="ssr" name="twitter:image" content="https://images.unsplash.com/photo-1495669735947-8ebe33b049bf?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1920&amp;h=1080&amp;q=80"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.1dbd3df5a133ad4bfceee6f845dec19f.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.1dbd3df5a133ad4bfceee6f845dec19f.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.1dbd3df5a133ad4bfceee6f845dec19f.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.1dbd3df5a133ad4bfceee6f845dec19f.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:400,700%7CCardo"><link rel="preload" href="/assets/css/10.styles.71c6ed44.css" as="style"><link rel="preload" href="/assets/js/app.b9c80bf7.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.c0a25600.js" as="script"><link rel="prefetch" href="/assets/js/12.bf723347.js"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.2347d897.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.99b74215.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.5f126c02.js"><link rel="prefetch" href="/assets/js/page--src--pages--talks-vue.5513b98e.js"><link rel="prefetch" href="/assets/js/page--src--pages--uses-vue.c5f56cc6.js"><link rel="prefetch" href="/assets/js/page--src--templates--author-vue.f0357935.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.7b7d9ef0.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--index-vue~page--src--templates--author-vue~page--src--templates--post-vue~~a0fae544.81352eac.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--post-vue.53a53220.js"><link rel="stylesheet" href="/assets/css/10.styles.71c6ed44.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body class="antialiased font-serif" data-vue-tag="%7B%22class%22:%7B%22ssr%22:%22antialiased%20font-serif%22%7D%7D">
    <div data-server-rendered="true" id="app" class="layout"><section class="menu"><div><nav><ul><li><a href="/" class="active">posts</a></li><li><a href="/about/">about</a></li><li><a href="/uses/">setup</a></li><li><a href="/talks/">talks</a></li><li><a href="/feed.xml">RSS Feed</a></li></ul></nav></div></section><main><header><div><div><div><h1>Como restaurar backups em um banco PostgreSQL</h1><p><span><a href="/author/anarute/">anarute</a>
            •
          </span><time datetime="2017-02-24 14:30:43">24 February, 2017</time></p></div></div><!----></div></header><article><div role="alert" class="warning">
        This post is over a year old, some of this information may be out of
        date.
      </div><div><p>De tempos em tempos eu preciso restaurar um backup de algum banco para outro ou
preencher o banco de um novo ambiente de desenvolvimento local com dados
para testes. Como não é uma tarefa diária, nem sempre me lembro como faz, então
resolvi juntar aqui o passo a passo até pra facilitar nas próximas vezes e talvez
possa também ajudar alguém.</p>
<p>Antes de poder restaurar algum backup, precisamos crear o dump! O comando utilizado
para isso é o <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">pg_dump</code> que já nos devolve um <em>dump</em> da tabela inteira - se
quiser saber mais <a href="https://www.postgresql.org/docs/current/static/app-pgdump.html" target="_blank" rel="nofollow noopener noreferrer">clique aqui</a>
para ler a documentação.</p>
<pre>pg_dump dbname > backupfile.sql</pre>
<p>No comando acima, extraímos todos os dados do banco (troque <em>dbname</em> pelo nome
da sua tabela) e jogamos em um arquivo <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">.sql</code>. Pronto, já temos o backup salvo.
<strong>Dica:</strong> esse é um jeito bem fácil de manter backup de seus bancos. Recomendo
criar um comando que faça esse backup e utilizar o
<a href="https://help.ubuntu.com/community/CronHowto" target="_blank" rel="nofollow noopener noreferrer">Cron</a> para fazer isso
automaticamente sempre.</p>
<p>Para restaurar o backup num banco, o postegres também nos permite fazer isso de
um jeito bem simples, mas tem alguns detalhes:</p>
<ol>
<li>o banco precisa existir com o mesmo nome do banco que foi extraído.</li>
<li>o banco não pode ter as tabelas criadas, senão vai dar conflito e a
restauração não vai dar certo.</li>
</ol>
<p>Nesse caso, se o banco já existir primeiro eu dou <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">dropdb db_name</code> que vai
deletar o banco (<strong>IMPORTANTE</strong>, eu só faço isso em bancos locais, porque isso
apaga <strong>todos os dados</strong> do banco, então <strong>NUNCA</strong> faça isso em produção a menos
que você saiba exatamente o que está fazendo. Dá justa causa, hein? Deus tá
vendo). Depois de deletar, precisamos recriá-la senão a restauração não vai
funcionar por não encontrar o banco. Para recriá-lo: <code class="shiki-inline" style="background: #2e3440; color: #d8dee9">createdb db_name</code></p>
<p>Por fim, para restaurar os dados, jogamos o arquivo no novo banco:</p>
<pre>psql dbname < infile</pre>
<p>Pronto, temos um banco restaurado! Para mim esse processo é fundamental em dois
momentos: quando por algum motivo - normalmente tenso - eu preciso restaurar o
banco em produção ou quando vou começar um novo ambiente de desenvolvimento e
preciso de dados para testar o app e as mudanças que estou fazendo.</p>
</div><footer><div><a href="/tag/sysadmin/" class="tag">
            sysadmin
          </a><a href="/tag/postgresql/" class="tag">
            postgresql
          </a><a href="/tag/databases/" class="tag">
            databases
          </a><a href="/tag/db/" class="tag">
            db
          </a></div></footer><div id="disqus_thread"></div></article></main></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"title":"Como restaurar backups em um banco PostgreSQL","slug":"como-restaurar-backups-em-um-banco-postgresql","datetime":"2017-02-24 14:30:43","content":"\u003Cp\u003EDe tempos em tempos eu preciso restaurar um backup de algum banco para outro ou\npreencher o banco de um novo ambiente de desenvolvimento local com dados\npara testes. Como não é uma tarefa diária, nem sempre me lembro como faz, então\nresolvi juntar aqui o passo a passo até pra facilitar nas próximas vezes e talvez\npossa também ajudar alguém.\u003C\u002Fp\u003E\n\u003Cp\u003EAntes de poder restaurar algum backup, precisamos crear o dump! O comando utilizado\npara isso é o \u003Ccode class=\"shiki-inline\" style=\"background: #2e3440; color: #d8dee9\"\u003Epg_dump\u003C\u002Fcode\u003E que já nos devolve um \u003Cem\u003Edump\u003C\u002Fem\u003E da tabela inteira - se\nquiser saber mais \u003Ca href=\"https:\u002F\u002Fwww.postgresql.org\u002Fdocs\u002Fcurrent\u002Fstatic\u002Fapp-pgdump.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Eclique aqui\u003C\u002Fa\u003E\npara ler a documentação.\u003C\u002Fp\u003E\n\u003Cpre\u003Epg_dump dbname \u003E backupfile.sql\u003C\u002Fpre\u003E\n\u003Cp\u003ENo comando acima, extraímos todos os dados do banco (troque \u003Cem\u003Edbname\u003C\u002Fem\u003E pelo nome\nda sua tabela) e jogamos em um arquivo \u003Ccode class=\"shiki-inline\" style=\"background: #2e3440; color: #d8dee9\"\u003E.sql\u003C\u002Fcode\u003E. Pronto, já temos o backup salvo.\n\u003Cstrong\u003EDica:\u003C\u002Fstrong\u003E esse é um jeito bem fácil de manter backup de seus bancos. Recomendo\ncriar um comando que faça esse backup e utilizar o\n\u003Ca href=\"https:\u002F\u002Fhelp.ubuntu.com\u002Fcommunity\u002FCronHowto\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003ECron\u003C\u002Fa\u003E para fazer isso\nautomaticamente sempre.\u003C\u002Fp\u003E\n\u003Cp\u003EPara restaurar o backup num banco, o postegres também nos permite fazer isso de\num jeito bem simples, mas tem alguns detalhes:\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003Eo banco precisa existir com o mesmo nome do banco que foi extraído.\u003C\u002Fli\u003E\n\u003Cli\u003Eo banco não pode ter as tabelas criadas, senão vai dar conflito e a\nrestauração não vai dar certo.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003ENesse caso, se o banco já existir primeiro eu dou \u003Ccode class=\"shiki-inline\" style=\"background: #2e3440; color: #d8dee9\"\u003Edropdb db_name\u003C\u002Fcode\u003E que vai\ndeletar o banco (\u003Cstrong\u003EIMPORTANTE\u003C\u002Fstrong\u003E, eu só faço isso em bancos locais, porque isso\napaga \u003Cstrong\u003Etodos os dados\u003C\u002Fstrong\u003E do banco, então \u003Cstrong\u003ENUNCA\u003C\u002Fstrong\u003E faça isso em produção a menos\nque você saiba exatamente o que está fazendo. Dá justa causa, hein? Deus tá\nvendo). Depois de deletar, precisamos recriá-la senão a restauração não vai\nfuncionar por não encontrar o banco. Para recriá-lo: \u003Ccode class=\"shiki-inline\" style=\"background: #2e3440; color: #d8dee9\"\u003Ecreatedb db_name\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EPor fim, para restaurar os dados, jogamos o arquivo no novo banco:\u003C\u002Fp\u003E\n\u003Cpre\u003Epsql dbname \u003C infile\u003C\u002Fpre\u003E\n\u003Cp\u003EPronto, temos um banco restaurado! Para mim esse processo é fundamental em dois\nmomentos: quando por algum motivo - normalmente tenso - eu preciso restaurar o\nbanco em produção ou quando vou começar um novo ambiente de desenvolvimento e\npreciso de dados para testar o app e as mudanças que estou fazendo.\u003C\u002Fp\u003E\n","description":"Guia básico para criar e restaurar um dump de um banco em PostgreSQL","cover":"https:\u002F\u002Fimages.unsplash.com\u002Fphoto-1495669735947-8ebe33b049bf?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1920&h=1080&q=80","fullscreen":false,"author":{"id":"anarute","title":"anarute","path":"\u002Fauthor\u002Fanarute\u002F"},"tags":[{"id":"sysadmin","title":"sysadmin","path":"\u002Ftag\u002Fsysadmin\u002F"},{"id":"postgresql","title":"postgresql","path":"\u002Ftag\u002Fpostgresql\u002F"},{"id":"databases","title":"databases","path":"\u002Ftag\u002Fdatabases\u002F"},{"id":"db","title":"db","path":"\u002Ftag\u002Fdb\u002F"}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.b9c80bf7.js" defer></script><script src="/assets/js/page--src--templates--post-vue.c0a25600.js" defer></script>
  </body>
</html>
